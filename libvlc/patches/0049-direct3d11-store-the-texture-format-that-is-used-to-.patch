From 7e5124af196df953c423982c4dfced4c3aee0769 Mon Sep 17 00:00:00 2001
From: Steve Lhomme <robux4@videolabs.io>
Date: Wed, 25 Jan 2017 16:39:54 +0100
Subject: [PATCH 49/55] direct3d11: store the texture format that is used to
 display the texture

---
 modules/video_chroma/d3d11_fmt.h        | 1 +
 modules/video_output/win32/direct3d11.c | 3 +++
 2 files changed, 4 insertions(+)

diff --git a/modules/video_chroma/d3d11_fmt.h b/modules/video_chroma/d3d11_fmt.h
index 18f7ae4..caea919 100644
--- a/modules/video_chroma/d3d11_fmt.h
+++ b/modules/video_chroma/d3d11_fmt.h
@@ -39,6 +39,7 @@ struct picture_sys_t
     unsigned                      slice_index;
     ID3D11VideoProcessorInputView *inputView; /* when used as processor input */
     ID3D11ShaderResourceView      *resourceView[D3D11_MAX_SHADER_VIEW];
+    DXGI_FORMAT                   formatTexture;
 };
 
 /* index to use for texture/resource that use a known DXGI format
diff --git a/modules/video_output/win32/direct3d11.c b/modules/video_output/win32/direct3d11.c
index 6e70dde..d1fe274 100644
--- a/modules/video_output/win32/direct3d11.c
+++ b/modules/video_output/win32/direct3d11.c
@@ -718,6 +718,7 @@ static picture_pool_t *Pool(vout_display_t *vd, unsigned pool_size)
         ID3D11Texture2D_AddRef(texture);
         picsys->texture[KNOWN_DXGI_INDEX] = texture;
         picsys->slice_index = picture_count;
+        picsys->formatTexture = vd->sys->picQuadConfig->formatTexture;
         picsys->context = vd->sys->d3dcontext;
 
         plane = KNOWN_DXGI_INDEX + 1;
@@ -2150,6 +2151,8 @@ static int AllocQuad(vout_display_t *vd, const video_format_t *fmt, d3d_quad_t *
     if (AllocateShaderView(vd, cfg, 0, &quad->picSys) != VLC_SUCCESS)
         goto error;
 
+    quad->picSys.formatTexture = cfg->formatTexture;
+
     quad->picSys.context = sys->d3dcontext;
     ID3D11DeviceContext_AddRef(quad->picSys.context);
 
-- 
2.10.1.windows.1

