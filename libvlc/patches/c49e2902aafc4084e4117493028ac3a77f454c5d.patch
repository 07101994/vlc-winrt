From c49e2902aafc4084e4117493028ac3a77f454c5d Mon Sep 17 00:00:00 2001
From: Steve Lhomme <robUx4@gmail.com>
Date: Tue, 25 Aug 2015 10:13:01 +0200
Subject: [PATCH] subtitles: don't force double directory separators

WindowsPhone doesn't like double backslashes in the path
---
 src/input/subtitles.c | 12 ++++++++++--
 1 file changed, 10 insertions(+), 2 deletions(-)

diff --git a/src/input/subtitles.c b/src/input/subtitles.c
index f1d5cdb..0fed845 100644
--- a/src/input/subtitles.c
+++ b/src/input/subtitles.c
@@ -360,8 +360,16 @@ char **subtitles_Detect( input_thread_t *p_this, char *psz_path,
                 struct stat st;
                 char *path;
 
-                if( asprintf( &path, "%s"DIR_SEP"%s", psz_dir, psz_name ) < 0 )
-                    continue;
+                if( psz_dir[0] == '\0' ) {
+                    if( asprintf( &path, "%s", psz_name ) < 0 )
+                        continue;
+                } else if( psz_dir[strlen( psz_dir ) - 1] == DIR_SEP_CHAR ) {
+                    if( asprintf( &path, "%s%s", psz_dir, psz_name ) < 0 )
+                        continue;
+                } else {
+                    if( asprintf( &path, "%s"DIR_SEP"%s", psz_dir, psz_name ) < 0 )
+                        continue;
+                }
 
                 if( strcmp( path, psz_fname )
                  && vlc_stat( path, &st ) == 0
