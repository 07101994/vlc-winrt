From 97861453cb25414a6f5aac90d9e413085d6b14f6 Mon Sep 17 00:00:00 2001
From: Martin Finkel <martin@videolabs.io>
Date: Wed, 10 Jan 2018 13:02:27 +0100
Subject: [PATCH 12/13] Revert "direct3d11: switch the pixel shader to point
 interpolation when reaching visible sides"

---
 modules/video_output/win32/direct3d11.c | 26 ++++++--------------------
 1 file changed, 6 insertions(+), 20 deletions(-)

diff --git a/modules/video_output/win32/direct3d11.c b/modules/video_output/win32/direct3d11.c
index 4a4887c..e228676 100644
--- a/modules/video_output/win32/direct3d11.c
+++ b/modules/video_output/win32/direct3d11.c
@@ -187,9 +187,7 @@ typedef struct d3d_vertex_t {
 
 typedef struct {
     FLOAT Opacity;
-    FLOAT BoundaryX;
-    FLOAT BoundaryY;
-    FLOAT LuminanceScale;
+    FLOAT opacityPadding[3];
 } PS_CONSTANT_BUFFER;
 
 typedef struct {
@@ -308,9 +306,7 @@ static const char* globPixelShaderDefault = "\
   cbuffer PS_CONSTANT_BUFFER : register(b0)\
   {\
     float Opacity;\
-    float BoundaryX;\
-    float BoundaryY;\
-    float LuminanceScale;\
+    float opacityPadding[3];\
   };\
   cbuffer PS_COLOR_TRANSFORM : register(b1)\
   {\
@@ -382,10 +378,7 @@ static const char* globPixelShaderDefault = "\
   {\
     float4 sample;\
     \
-    if (In.Texture.x > BoundaryX || In.Texture.y > BoundaryY) \
-        sample = sampleTexture( SamplerStates[1], In.Texture );\
-    else\
-        sample = sampleTexture( SamplerStates[0], In.Texture );\
+    sample = sampleTexture( SamplerStates[0], In.Texture );\
     float4 rgba = mul(mul(sample, WhitePoint), Colorspace);\
     float opacity = rgba.a * Opacity;\
     float3 rgb = (float3)rgba;\
@@ -2542,16 +2535,9 @@ static int SetupQuad(vout_display_t *vd, const video_format_t *fmt, d3d_quad_t *
     quad->f_luminance_scale = (float)src_luminance_peak / (float)sys->display.luminance_peak;
 
     /* pixel shader constant buffer */
-    PS_CONSTANT_BUFFER defaultConstants;
-    defaultConstants.Opacity = 1.0;
-    if (fmt->i_visible_width == fmt->i_width)
-        defaultConstants.BoundaryX = 1.0; /* let texture clamping happen */
-    else
-        defaultConstants.BoundaryX = (FLOAT) (fmt->i_visible_width - 1) / fmt->i_width;
-    if (fmt->i_visible_height == fmt->i_height)
-        defaultConstants.BoundaryY = 1.0; /* let texture clamping happen */
-    else
-        defaultConstants.BoundaryY = (FLOAT) (fmt->i_visible_height - 1) / fmt->i_height;
+    PS_CONSTANT_BUFFER defaultConstants = {
+      .Opacity = 1,
+    };
     defaultConstants.LuminanceScale = quad->f_luminance_scale;
 
     static_assert((sizeof(PS_CONSTANT_BUFFER)%16)==0,"Constant buffers require 16-byte alignment");
-- 
2.10.1.windows.1

